{% extends 'base.html' %}

{% block content %}

<div class="text-center mb-12 pt-8 animate-fade-in-up">
    <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-emerald-600 to-teal-700 text-white shadow-lg mb-6 rotate-3 hover:rotate-6 transition duration-500">
        <i class="fa-solid fa-truck-ramp-box text-2xl"></i>
    </div>
    <h1 class="text-4xl md:text-6xl font-black text-emerald-950 tracking-tight mb-4 leading-tight">
        Pusat <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-600 to-teal-500">Operasional</span>
    </h1>
    <p class="text-emerald-900/60 font-medium text-lg max-w-2xl mx-auto">
        Pantau penjemputan, kelola alamat, dan atur jadwal lingkungan dalam satu kendali.
    </p>
</div>

<div x-data="{ 
    activeTab: '{{ active_tab_default|default:'alamat' }}', 
    
    // STATES MODAL
    modalAlamat: false,
    modalRequest: false,
    modalAdmin: false,
    modalKurir: false,
    
    // DATA FORM
    formAlamat: { id: '', label: '', area_id: '', area_name: '-- Pilih Area --', detail: '' },
    formRequest: { jenis_val: 'campur', jenis_name: 'Campuran / Lainnya', alamat_id: '', alamat_name: '-- Pilih Lokasi --', catatan: '' },
    formAdmin: { id: '', kurir_id: '', kurir_name: '-- Pilih Kurir --' },
    formKurir: { id: '' },

    // Helpers
    resetAlamat() { this.formAlamat = { id:'', label:'', area_id:'', area_name:'-- Pilih Area --', detail:'' }; },
    resetRequest() { this.formRequest = { jenis_val:'campur', jenis_name:'Campuran / Lainnya', alamat_id:'', alamat_name:'-- Pilih Lokasi --', catatan:'' }; }

}" class="max-w-6xl mx-auto mb-24 px-4 relative z-10">

    <div class="flex justify-center mb-10 sticky top-24 z-30">
        <div class="bg-white/80 backdrop-blur-xl p-1.5 rounded-2xl border border-emerald-900/10 inline-flex flex-wrap justify-center gap-2 shadow-[0_8px_30px_rgb(0,0,0,0.04)]">
            
            <button @click="activeTab = 'alamat'" 
                :class="activeTab === 'alamat' ? 'bg-emerald-800 text-white shadow-lg shadow-emerald-900/20' : 'text-emerald-900 hover:bg-emerald-50'"
                class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 flex items-center gap-2">
                <i class="fa-solid fa-map-location-dot"></i> <span class="hidden sm:inline">Alamat</span>
            </button>
            
            <button @click="activeTab = 'penjemputan'" 
                :class="activeTab === 'penjemputan' ? 'bg-emerald-800 text-white shadow-lg shadow-emerald-900/20' : 'text-emerald-900 hover:bg-emerald-50'"
                class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 flex items-center gap-2">
                {% if user.profilpengguna.peran == 'admin_sajiwa' %}
                    <i class="fa-solid fa-inbox"></i> <span class="hidden sm:inline">Permintaan</span>
                {% elif user.profilpengguna.peran == 'kurir' %}
                    <i class="fa-solid fa-dolly"></i> <span class="hidden sm:inline">Tugas</span>
                {% else %}
                    <i class="fa-solid fa-recycle"></i> <span class="hidden sm:inline">Jemput</span>
                {% endif %}
            </button>
            
            <button @click="activeTab = 'jadwal'" 
                :class="activeTab === 'jadwal' ? 'bg-emerald-800 text-white shadow-lg shadow-emerald-900/20' : 'text-emerald-900 hover:bg-emerald-50'"
                class="px-6 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 flex items-center gap-2">
                <i class="fa-regular fa-calendar-days"></i> <span class="hidden sm:inline">Jadwal</span>
            </button>
        </div>
    </div>

    <div class="min-h-[400px] relative z-0 bg-white/40 backdrop-blur-md border border-white/40 shadow-lg rounded-3xl p-6">

        <div x-show="activeTab === 'alamat'" x-transition.opacity.duration.300ms>
            <div class="flex justify-between items-center mb-8 border-b border-emerald-900/20 pb-4">
                <div>
                    <h3 class="text-2xl font-black text-emerald-950">Data Alamat</h3>
                    <p class="text-emerald-900/70 text-sm mt-1">Kelola titik penjemputan Anda.</p>
                </div>
                {% if user.profilpengguna.peran == 'warga' %}
                <button @click="resetAlamat(); modalAlamat = true" 
                    class="bg-emerald-600 hover:bg-emerald-500 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-emerald-600/20 flex items-center gap-2 transition hover:-translate-y-1">
                    <i class="fa-solid fa-plus"></i> Tambah
                </button>
                {% endif %}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                {% for a in daftar_alamat %}
                <div class="bg-white p-6 rounded-[2rem] border border-emerald-900/5 shadow-sm hover:shadow-xl hover:border-emerald-500/30 transition duration-300 group relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-emerald-50 rounded-bl-[4rem] -mr-4 -mt-4 transition group-hover:bg-emerald-100"></div>
                    
                    <div class="relative z-10 flex justify-between items-start">
                        <div class="space-y-2">
                            <span class="text-[10px] font-bold text-emerald-600 uppercase tracking-widest bg-emerald-100 px-3 py-1 rounded-full inline-block border border-emerald-200">
                                <i class="fa-solid fa-location-dot mr-1"></i> {{ a.label }}
                            </span>
                            <h4 class="text-emerald-950 font-bold text-xl leading-tight">{{ a.area.nama_jalan }}</h4>
                            <p class="text-emerald-800/60 text-sm font-medium">Lingkungan RT/RW: {{ a.area.rt_rw }}</p>
                            <div class="bg-emerald-50/50 p-3 rounded-xl border border-emerald-900/5 mt-3">
                                <p class="text-emerald-900/50 text-xs italic"><i class="fa-solid fa-circle-info mr-1"></i> {{ a.detail_lain }}</p>
                            </div>
                        </div>
                        {% if user.profilpengguna.peran == 'warga' %}
                        <button @click="modalAlamat = true; formAlamat = { id: '{{ a.id }}', label: '{{ a.label }}', area_id: '{{ a.area.id }}', area_name: '{{ a.area.nama_jalan }}', detail: '{{ a.detail_lain|escapejs }}' }" 
                            class="bg-white shadow-md p-2.5 rounded-xl text-emerald-900/40 hover:text-emerald-600 hover:shadow-lg transition border border-emerald-900/5">
                            <i class="fa-solid fa-pen"></i>
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <div class="col-span-full py-16 text-center bg-white rounded-[2rem] border-2 border-dashed border-emerald-900/10">
                    <div class="w-16 h-16 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4 text-emerald-300">
                        <i class="fa-solid fa-map-pin text-2xl"></i>
                    </div>
                    <p class="text-emerald-900/40 font-bold">Belum ada data alamat tersimpan.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <div x-show="activeTab === 'penjemputan'" x-transition.opacity.duration.300ms>
            <div class="flex justify-between items-center mb-8 border-b border-emerald-900/5 pb-4">
                <div>
                    <h3 class="text-2xl font-black text-emerald-950">
                        {% if user.profilpengguna.peran == 'admin_sajiwa' %}Permintaan Masuk{% elif user.profilpengguna.peran == 'kurir' %}Tugas Saya{% else %}Request Saya{% endif %}
                    </h3>
                    <p class="text-emerald-900/50 text-sm mt-1">Status real-time operasional lapangan.</p>
                </div>
                {% if user.profilpengguna.peran == 'warga' %}
                <button @click="resetRequest(); modalRequest = true" 
                    class="bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-2.5 rounded-xl text-sm font-bold shadow-lg shadow-blue-500/20 flex items-center gap-2 transition hover:-translate-y-1">
                    <i class="fa-solid fa-bullhorn"></i> Lapor Sampah
                </button>
                {% endif %}
            </div>

            <div class="space-y-4">
                {% for item in data_request %}
                    
                    {% if user.profilpengguna.peran == 'admin_sajiwa' and item.status == 'menunggu' %}
                    <div class="bg-white border border-emerald-900/5 p-6 rounded-[2rem] flex flex-col md:flex-row items-center justify-between gap-6 shadow-sm hover:shadow-xl hover:border-blue-200 transition duration-300 relative overflow-hidden group">
                        <div class="absolute left-0 top-0 w-1 h-full bg-yellow-400"></div>
                        
                        <div class="flex items-start gap-5 w-full">
                            <div class="w-14 h-14 rounded-2xl bg-yellow-50 text-yellow-600 flex items-center justify-center text-xl shrink-0 shadow-inner">
                                <i class="fa-solid fa-clock"></i>
                            </div>
                            <div class="flex-grow">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider">
                                        {{ item.get_jenis_sampah_display }}
                                    </span>
                                    <span class="text-xs text-emerald-900/40 font-bold">‚Ä¢ {{ item.created_at|date:"d M H:i" }}</span>
                                </div>
                                <h4 class="text-emerald-950 font-bold text-lg">{{ item.pemohon.username }}</h4>
                                <p class="text-sm text-emerald-900/60">{{ item.alamat.area.nama_jalan }} <span class="text-emerald-900/40 text-xs">({{ item.alamat.detail_lain }})</span></p>
                                {% if item.catatan %}
                                <div class="mt-2 text-xs text-emerald-700 italic bg-emerald-50 px-3 py-1.5 rounded-lg inline-block">
                                    "{{ item.catatan }}"
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <button @click="modalAdmin = true; formAdmin.id = '{{ item.id }}'" 
                            class="px-6 py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold text-sm rounded-xl shadow-lg shadow-blue-600/20 transition transform hover:scale-105 whitespace-nowrap">
                            Atur Jadwal
                        </button>
                    </div>

                    {% elif user.profilpengguna.peran == 'kurir' and item.status == 'dijemput' %}
                    <div class="relative bg-gradient-to-br from-emerald-800 to-emerald-600 p-8 rounded-[2rem] shadow-xl shadow-emerald-900/20 group overflow-hidden text-white">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-20 -mt-20 blur-3xl pointer-events-none"></div>
                        
                        <div class="flex justify-between items-start mb-6 relative z-10">
                            <div class="bg-white/20 backdrop-blur-md px-4 py-1.5 rounded-lg text-xs font-bold shadow-lg border border-white/10">
                                <i class="fa-regular fa-clock mr-1"></i> {{ item.waktu_jemput|time:"H:i" }} WIB
                            </div>
                            <span class="text-emerald-100/80 text-xs font-bold uppercase tracking-wider bg-black/20 px-3 py-1 rounded-full">{{ item.tanggal_jemput|date:"d M Y" }}</span>
                        </div>
                        
                        <h3 class="text-2xl font-black mb-1">{{ item.pemohon.username }}</h3>
                        <p class="text-emerald-100 text-sm font-medium mb-6 flex items-center gap-2">
                            <i class="fa-solid fa-map-pin"></i> {{ item.alamat.area.nama_jalan }} 
                            <span class="opacity-60 font-normal">({{ item.alamat.detail_lain }})</span>
                        </p>
                        
                        <div class="flex items-center gap-4 border-t border-white/20 pt-5">
                            <div class="flex-grow">
                                <p class="text-xs text-emerald-200 uppercase font-bold mb-1">Muatan</p>
                                <p class="font-bold text-lg">{{ item.get_jenis_sampah_display }}</p>
                            </div>
                            <button @click="modalKurir = true; formKurir.id = '{{ item.id }}'" 
                                class="px-6 py-3 bg-white text-emerald-800 hover:bg-emerald-50 rounded-xl font-bold text-sm shadow-lg transition transform hover:scale-105">
                                <i class="fa-solid fa-check mr-1"></i> Selesai
                            </button>
                        </div>
                    </div>

                    {% elif user.profilpengguna.peran == 'warga' %}
                    <div class="bg-white border border-emerald-900/5 p-5 rounded-[1.5rem] flex items-center justify-between gap-4 shadow-sm hover:shadow-md transition group">
                        <div class="flex items-center gap-5">
                            <div class="w-12 h-12 rounded-xl flex items-center justify-center text-xl shadow-sm transition-colors duration-300
                                {% if item.status == 'menunggu' %}bg-yellow-50 text-yellow-500 group-hover:bg-yellow-100
                                {% elif item.status == 'dijemput' %}bg-blue-50 text-blue-500 group-hover:bg-blue-100
                                {% else %}bg-emerald-50 text-emerald-500 group-hover:bg-emerald-100{% endif %}">
                                <i class="fa-solid {% if item.status == 'menunggu' %}fa-hourglass-half{% elif item.status == 'dijemput' %}fa-truck-fast{% else %}fa-check-circle{% endif %}"></i>
                            </div>
                            <div>
                                <h4 class="text-emerald-950 font-bold text-sm">{{ item.get_jenis_sampah_display }}</h4>
                                <p class="text-xs text-emerald-900/40 font-medium">{{ item.alamat.label }} <span class="mx-1 text-emerald-200">‚Ä¢</span> {{ item.created_at|date:"d/m" }}</p>
                                {% if item.status == 'dijemput' %}
                                    <p class="text-[10px] text-blue-600 mt-1 font-bold bg-blue-50 px-2 py-0.5 rounded-md inline-block">
                                        Jadwal: {{ item.tanggal_jemput|date:"d/m" }} - {{ item.waktu_jemput|time:"H:i" }}
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                        <span class="text-[10px] font-bold uppercase px-3 py-1.5 rounded-lg tracking-wider border
                             {% if item.status == 'menunggu' %}bg-yellow-50 text-yellow-600 border-yellow-100
                             {% elif item.status == 'dijemput' %}bg-blue-50 text-blue-600 border-blue-100
                             {% else %}bg-emerald-50 text-emerald-600 border-emerald-100{% endif %}">
                             {{ item.get_status_display }}
                        </span>
                    </div>
                    {% endif %}
                
                {% empty %}
                    <div class="col-span-full py-16 text-center bg-white rounded-[2rem] border-2 border-dashed border-emerald-900/10">
                        <div class="w-16 h-16 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4 text-emerald-300">
                            <i class="fa-solid fa-clipboard-check text-2xl"></i>
                        </div>
                        <p class="text-emerald-900/40 font-bold">Tidak ada aktivitas saat ini.</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div x-show="activeTab === 'jadwal'" x-transition.opacity.duration.300ms>
            <div class="mb-8 border-b border-emerald-900/5 pb-4">
                <h3 class="text-2xl font-black text-emerald-950">Kalender Operasional</h3>
                <p class="text-emerald-900/50 text-sm mt-1">Agenda penjemputan yang telah terkonfirmasi.</p>
            </div>

            <div class="space-y-3">
                {% for item in data_jadwal %}
                <div class="flex items-center gap-5 p-5 rounded-2xl bg-white border border-emerald-900/5 hover:border-emerald-500/30 hover:shadow-lg transition duration-300 group">
                    <div class="text-center w-16 bg-emerald-50 rounded-xl p-2 shrink-0 border border-emerald-100 group-hover:bg-emerald-600 group-hover:text-white transition-colors duration-300">
                        <div class="text-[10px] uppercase font-bold opacity-70">{{ item.tanggal_jemput|date:"M" }}</div>
                        <div class="text-2xl font-black">{{ item.tanggal_jemput|date:"d" }}</div>
                    </div>
                    <div class="flex-grow">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xs font-bold text-blue-600 bg-blue-50 border border-blue-100 px-2 py-0.5 rounded-md">
                                <i class="fa-regular fa-clock mr-1"></i>{{ item.waktu_jemput|time:"H:i" }}
                            </span>
                            <span class="text-[10px] bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-md uppercase font-bold tracking-wider">
                                {{ item.get_jenis_sampah_display }}
                            </span>
                        </div>
                        <p class="text-base font-bold text-emerald-950">{{ item.pemohon.username }}</p>
                        <p class="text-xs text-emerald-900/50">{{ item.alamat.area.nama_jalan }}</p>
                    </div>
                    <div class="text-right hidden sm:block bg-gray-50 px-4 py-2 rounded-xl">
                        <p class="text-[10px] text-gray-400 uppercase font-bold">Petugas</p>
                        <p class="text-sm font-bold text-emerald-700">{{ item.kurir_pemeriksa.username }}</p>
                    </div>
                </div>
                {% empty %}
                <div class="col-span-full py-16 text-center bg-white rounded-[2rem] border-2 border-dashed border-emerald-900/10">
                    <div class="w-16 h-16 bg-emerald-50 rounded-full flex items-center justify-center mx-auto mb-4 text-emerald-300">
                        <i class="fa-regular fa-calendar-xmark text-2xl"></i>
                    </div>
                    <p class="text-emerald-900/40 font-bold">Belum ada jadwal penjemputan.</p>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>

    <div x-show="modalAlamat" class="fixed inset-0 z-[100] flex items-center justify-center bg-emerald-950/80 backdrop-blur-sm p-4 transition-opacity" style="display: none;">
        <div @click.outside="modalAlamat = false" class="bg-[#022c22] border border-white/10 w-full max-w-md rounded-3xl p-8 shadow-2xl relative animate-fade-in ring-1 ring-white/10">
            <h3 class="text-2xl font-black text-white mb-6 flex items-center gap-3">
                <i class="fa-solid fa-map-location-dot text-emerald-500"></i> Kelola Alamat
            </h3>
            
            <form method="POST" class="space-y-5">
                {% csrf_token %}
                <input type="hidden" name="id_alamat" :value="formAlamat.id">
                
                <div>
                    <label class="text-xs text-emerald-400 font-bold uppercase tracking-wider mb-2 block ml-1">Label Lokasi</label>
                    <input type="text" name="label_alamat" x-model="formAlamat.label" placeholder="Contoh: Rumah" required 
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition placeholder-gray-500">
                </div>

                <div class="relative" x-data="{ open: false }">
                    <label class="text-xs text-emerald-400 font-bold uppercase tracking-wider mb-2 block ml-1">Area Lingkungan</label>
                    <input type="hidden" name="area_id" :value="formAlamat.area_id" required>
                    
                    <button type="button" @click="open = !open" @click.outside="open = false"
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-left text-sm text-white flex justify-between items-center hover:bg-white/10 transition">
                        <span x-text="formAlamat.area_name"></span>
                        <i class="fa-solid fa-chevron-down text-gray-500 text-xs transition-transform" :class="open ? 'rotate-180' : ''"></i>
                    </button>
                    
                    <div x-show="open" class="absolute z-50 top-full mt-2 left-0 w-full bg-[#0a1a15] border border-emerald-500/30 rounded-xl max-h-48 overflow-y-auto shadow-2xl ring-1 ring-white/10">
                        {% for area in semua_area %}
                        <div @click="formAlamat.area_id = '{{ area.id }}'; formAlamat.area_name = '{{ area.nama_jalan }} ({{ area.rt_rw }})'; open = false"
                             class="px-4 py-3 text-sm text-gray-300 hover:bg-emerald-600/20 hover:text-white cursor-pointer transition border-b border-white/5 last:border-0">
                            {{ area.nama_jalan }} ({{ area.rt_rw }})
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div>
                    <label class="text-xs text-emerald-400 font-bold uppercase tracking-wider mb-2 block ml-1">Detail</label>
                    <textarea name="alamat_lengkap" x-model="formAlamat.detail" rows="3" placeholder="No. Rumah, Warna Pagar..." required 
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition placeholder-gray-500"></textarea>
                </div>

                <div class="flex gap-3 pt-4 border-t border-white/10">
                    <button type="button" @click="modalAlamat = false" class="flex-1 py-3 rounded-xl bg-white/5 text-gray-400 hover:text-white hover:bg-white/10 text-sm font-bold transition">Batal</button>
                    <button type="submit" name="simpan_alamat" class="flex-1 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl text-sm font-bold shadow-lg shadow-emerald-900/50 transition transform active:scale-95">Simpan</button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="modalRequest" class="fixed inset-0 z-[100] flex items-center justify-center bg-emerald-950/80 backdrop-blur-sm p-4 transition-opacity" style="display: none;">
        <div @click.outside="modalRequest = false" class="bg-[#022c22] border border-white/10 w-full max-w-md rounded-3xl p-8 shadow-2xl relative animate-fade-in ring-1 ring-white/10">
            <h3 class="text-2xl font-black text-white mb-1 flex items-center gap-3">
                <i class="fa-solid fa-recycle text-emerald-500"></i> Lapor Sampah
            </h3>
            <p class="text-xs text-gray-400 mb-6 ml-9">Pilih jenis sampah dan lokasi penjemputan.</p>
            
            <form method="POST" class="space-y-5">
                {% csrf_token %}
                
                <div class="relative" x-data="{ open: false }">
                    <label class="text-xs text-emerald-400 font-bold uppercase tracking-wider mb-2 block ml-1">Lokasi Jemput</label>
                    <input type="hidden" name="alamat_id" :value="formRequest.alamat_id" required>
                    <button type="button" @click="open = !open" @click.outside="open = false"
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-left text-sm text-white flex justify-between items-center hover:bg-white/10 transition">
                        <span x-text="formRequest.alamat_name"></span>
                        <i class="fa-solid fa-chevron-down text-gray-500 text-xs transition-transform" :class="open ? 'rotate-180' : ''"></i>
                    </button>
                    <div x-show="open" class="absolute z-50 top-full mt-2 left-0 w-full bg-[#0a1a15] border border-emerald-500/30 rounded-xl shadow-2xl ring-1 ring-white/10">
                        {% for a in daftar_alamat %}
                        <div @click="formRequest.alamat_id = '{{ a.id }}'; formRequest.alamat_name = '{{ a.label }} - {{ a.area.nama_jalan }}'; open = false"
                             class="px-4 py-3 text-sm text-gray-300 hover:bg-emerald-600/20 hover:text-white cursor-pointer transition border-b border-white/5 last:border-0">
                            {{ a.label }} - {{ a.area.nama_jalan }}
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="relative" x-data="{ open: false }">
                    <label class="text-xs text-emerald-400 font-bold uppercase tracking-wider mb-2 block ml-1">Kategori Sampah</label>
                    <input type="hidden" name="jenis_sampah" :value="formRequest.jenis_val" required>
                    <button type="button" @click="open = !open" @click.outside="open = false"
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-left text-sm text-white flex justify-between items-center hover:bg-white/10 transition">
                        <span x-text="formRequest.jenis_name"></span>
                        <i class="fa-solid fa-chevron-down text-gray-500 text-xs transition-transform" :class="open ? 'rotate-180' : ''"></i>
                    </button>
                    <div x-show="open" class="absolute z-50 top-full mt-2 left-0 w-full bg-[#0a1a15] border border-emerald-500/30 rounded-xl max-h-48 overflow-y-auto shadow-2xl ring-1 ring-white/10">
                        <div @click="formRequest.jenis_val='campur'; formRequest.jenis_name='Campuran / Lainnya'; open=false" class="dropdown-item px-4 py-2.5 hover:bg-white/10 cursor-pointer text-sm text-gray-300 border-b border-white/5">üì¶ Campuran / Lainnya</div>
                        <div @click="formRequest.jenis_val='plastik'; formRequest.jenis_name='Plastik (Botol/Gelas)'; open=false" class="dropdown-item px-4 py-2.5 hover:bg-white/10 cursor-pointer text-sm text-gray-300 border-b border-white/5">ü•§ Plastik</div>
                        <div @click="formRequest.jenis_val='kertas'; formRequest.jenis_name='Kertas / Kardus'; open=false" class="dropdown-item px-4 py-2.5 hover:bg-white/10 cursor-pointer text-sm text-gray-300 border-b border-white/5">üìÑ Kertas / Kardus</div>
                        <div @click="formRequest.jenis_val='logam'; formRequest.jenis_name='Kaleng / Logam'; open=false" class="dropdown-item px-4 py-2.5 hover:bg-white/10 cursor-pointer text-sm text-gray-300 border-b border-white/5">üî© Kaleng / Logam</div>
                        <div @click="formRequest.jenis_val='kaca'; formRequest.jenis_name='Kaca / Beling'; open=false" class="dropdown-item px-4 py-2.5 hover:bg-white/10 cursor-pointer text-sm text-gray-300 border-b border-white/5">üç∑ Kaca / Beling</div>
                        <div @click="formRequest.jenis_val='elektronik'; formRequest.jenis_name='E-Waste / Elektronik'; open=false" class="dropdown-item px-4 py-2.5 hover:bg-white/10 cursor-pointer text-sm text-gray-300 border-b border-white/5">üîå Elektronik</div>
                        <div @click="formRequest.jenis_val='minyak'; formRequest.jenis_name='Minyak Jelantah'; open=false" class="dropdown-item px-4 py-2.5 hover:bg-white/10 cursor-pointer text-sm text-gray-300">üõ¢Ô∏è Minyak Jelantah</div>
                    </div>
                </div>

                <div>
                    <label class="text-xs text-emerald-400 font-bold uppercase tracking-wider mb-2 block ml-1">Catatan</label>
                    <input type="text" name="catatan" x-model="formRequest.catatan" placeholder="Opsional..." 
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none transition placeholder-gray-500">
                </div>

                <div class="flex gap-3 pt-4 border-t border-white/10">
                    <button type="button" @click="modalRequest = false" class="flex-1 py-3 rounded-xl bg-white/5 text-gray-400 hover:text-white hover:bg-white/10 text-sm font-bold transition">Batal</button>
                    <button type="submit" name="request_jemput" class="flex-1 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl text-sm font-bold shadow-lg shadow-emerald-900/50 transition transform active:scale-95">Lapor</button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="modalAdmin" class="fixed inset-0 z-[100] flex items-center justify-center bg-emerald-950/80 backdrop-blur-sm p-4 transition-opacity" style="display: none;">
        <div @click.outside="modalAdmin = false" class="bg-[#022c22] border border-blue-500/30 w-full max-w-md rounded-3xl p-8 shadow-2xl relative animate-fade-in ring-1 ring-white/10">
            <h3 class="text-2xl font-black text-white mb-6 flex items-center gap-3">
                <i class="fa-solid fa-user-clock text-blue-500"></i> Atur Penugasan
            </h3>
            
            <form method="POST" class="space-y-5">
                {% csrf_token %}
                <input type="hidden" name="id_jemput" :value="formAdmin.id">
                
                <div class="relative" x-data="{ open: false }">
                    <label class="text-xs text-blue-400 font-bold uppercase tracking-wider mb-2 block ml-1">Pilih Kurir</label>
                    <input type="hidden" name="kurir_id" :value="formAdmin.kurir_id" required>
                    <button type="button" @click="open = !open" @click.outside="open = false"
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-left text-sm text-white flex justify-between items-center hover:bg-white/10 transition focus:border-blue-500">
                        <span x-text="formAdmin.kurir_name"></span>
                        <i class="fa-solid fa-chevron-down text-gray-500 text-xs transition-transform" :class="open ? 'rotate-180' : ''"></i>
                    </button>
                    <div x-show="open" class="absolute z-50 top-full mt-2 left-0 w-full bg-[#0a1a15] border border-blue-500/30 rounded-xl shadow-2xl ring-1 ring-white/10">
                        {% for k in list_kurir %}
                        <div @click="formAdmin.kurir_id = '{{ k.id }}'; formAdmin.kurir_name = '{{ k.username }}'; open = false"
                             class="px-4 py-3 text-sm text-gray-300 hover:bg-blue-600/20 hover:text-white cursor-pointer transition border-b border-white/5 last:border-0">
                            {{ k.username }}
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-blue-400 font-bold uppercase tracking-wider mb-2 block ml-1">Tanggal</label>
                        <input type="date" name="tanggal_set" required class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none [color-scheme:dark]">
                    </div>
                    <div>
                        <label class="text-xs text-blue-400 font-bold uppercase tracking-wider mb-2 block ml-1">Jam</label>
                        <input type="time" name="waktu_set" required class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none [color-scheme:dark]">
                    </div>
                </div>

                <div class="flex gap-3 pt-4 border-t border-white/10">
                    <button type="button" @click="modalAdmin = false" class="flex-1 py-3 rounded-xl bg-white/5 text-gray-400 hover:text-white hover:bg-white/10 text-sm font-bold transition">Batal</button>
                    <button type="submit" name="atur_jadwal" class="flex-1 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl text-sm font-bold shadow-lg shadow-blue-900/50 transition transform active:scale-95">Tetapkan</button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="modalKurir" class="fixed inset-0 z-[100] flex items-center justify-center bg-emerald-950/80 backdrop-blur-sm p-4 transition-opacity" style="display: none;">
        <div @click.outside="modalKurir = false" class="bg-[#022c22] border border-emerald-500/30 w-full max-w-sm rounded-3xl p-8 shadow-2xl relative animate-fade-in ring-1 ring-white/10">
            <h3 class="text-2xl font-black text-white mb-2 text-center">Tugas Selesai?</h3>
            <p class="text-xs text-gray-400 mb-8 text-center">Masukkan berat total sampah yang diambil.</p>
            
            <form method="POST" class="space-y-6">
                {% csrf_token %}
                <input type="hidden" name="id_jemput" :value="formKurir.id">
                
                <div>
                    <label class="text-xs text-emerald-400 font-bold uppercase tracking-wider mb-2 block text-center">Berat Total (Kg)</label>
                    <div class="relative max-w-[200px] mx-auto">
                        <input type="number" step="0.1" name="berat_aktual" placeholder="0.0" required 
                            class="w-full bg-white/5 border-b-2 border-emerald-500 rounded-xl px-4 py-4 text-white text-5xl font-black text-center focus:outline-none transition placeholder-white/20">
                    </div>
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="button" @click="modalKurir = false" class="flex-1 py-3 rounded-xl bg-white/5 text-gray-400 hover:text-white hover:bg-white/10 text-sm font-bold transition">Batal</button>
                    <button type="submit" name="lapor_kurir" class="flex-1 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl text-sm font-bold shadow-lg shadow-emerald-900/50 transition transform active:scale-95">Selesai</button>
                </div>
            </form>
        </div>
    </div>

</div>
{% endblock %}