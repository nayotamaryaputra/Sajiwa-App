{% extends 'base.html' %}

{% block content %}

<style>
    .glass-card-news {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.9);
        box-shadow: 0 4px 20px -5px rgba(0, 44, 34, 0.05);
    }
    
    .news-title-gradient {
        background: linear-gradient(135deg, #064e3b 0%, #059669 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .shimmer-light {
        position: relative;
        overflow: hidden;
    }
    .shimmer-light::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        transform: translateX(-100%);
        animation: shimmer-effect 3s infinite;
    }
    @keyframes shimmer-effect {
        100% { transform: translateX(100%); }
    }
</style>

<div class="relative py-12">
    <div class="absolute top-0 right-0 w-[400px] h-[400px] bg-emerald-100/50 blur-[100px] rounded-full -z-10"></div>

    <div class="text-center mb-20 animate-fade-in">
        <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-gradient-to-r from-emerald-800/90 to-emerald-600/70 mb-6">
            <i class="fa-solid fa-newspaper text-white text-xs"></i>
            <span class="text-[12px] font-black text-white tracking-[0.2em] uppercase">Sajiwa Journal</span>
        </div>
        <h1 class="text-4xl md:text-6xl font-black text-emerald-950 tracking-tight mb-6">
            Kabar <span class="news-title-gradient">Lingkungan.</span>
        </h1>
        <p class="text-emerald-900/60 max-w-xl mx-auto text-base md:text-lg font-medium">
            Update terbaru mengenai kegiatan komunitas, edukasi daur ulang, dan pengumuman sistem Sajiwa.
        </p>
    </div>

    {% if user.is_authenticated and user.profilpengguna.peran == 'admin_sajiwa' %}
    <div x-data="{ openForm: false }" class="mb-24 max-w-5xl mx-auto animate-fade-in">
        
        <div class="flex justify-center mb-8">
            <button @click="openForm = !openForm" 
                class="group relative px-8 py-3 rounded-full bg-gradient-to-r from-emerald-900 to-emerald-600 border border-emerald-500/30 text-white font-bold overflow-hidden transition-all hover:border-emerald-500 hover:shadow-[0_0_25px_rgba(16,185,129,0.4)]">
                <div class="absolute inset-0 bg-emerald-600/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                <span class="relative flex items-center gap-3">
                    <i class="fa-solid" :class="openForm ? 'fa-xmark' : 'fa-pen-to-square'"></i>
                    <span x-text="openForm ? 'Tutup Editor' : 'Tulis Berita Baru'"></span>
                </span>
            </button>
        </div>

        <div x-show="openForm" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             class="glass-panel p-8 md:p-10 rounded-[2.5rem] border border-white/10 relative overflow-hidden">
            
            <div class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/10 blur-[60px] rounded-full pointer-events-none"></div>

            <form method="POST" enctype="multipart/form-data" class="grid grid-cols-1 md:grid-cols-12 gap-8 relative z-10">
                {% csrf_token %}
                
                <div class="md:col-span-5 space-y-3">
                    <label class="text-xs font-bold text-emerald-400 uppercase tracking-wider ml-1">Cover Artikel</label>
                    
                    <div class="relative w-full aspect-[4/3] border-2 border-dashed border-emerald-900/50 rounded-3xl hover:border-emerald-500/50 transition-colors group bg-white/20 overflow-hidden flex flex-col items-center justify-center cursor-pointer">
                        <input type="file" name="gambar" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20"
                               onchange="const file = this.files[0]; if(file){ const reader = new FileReader(); reader.onload = (e) => { this.nextElementSibling.src = e.target.result; this.nextElementSibling.classList.remove('hidden'); this.nextElementSibling.nextElementSibling.classList.add('hidden'); }; reader.readAsDataURL(file); }">
                        
                        <img src="" class="absolute inset-0 w-full h-full object-cover hidden z-10">
                        
                        <div class="text-center p-6 group-hover:scale-105 transition duration-300">
                            <div class="w-16 h-16 rounded-full bg-emerald-500/10 flex items-center justify-center mx-auto mb-4 text-emerald-400 border border-emerald-500/20">
                                <i class="fa-solid fa-cloud-arrow-up text-2xl"></i>
                            </div>
                            <p class="text-sm text-gray-500 font-semibold">Klik atau Drop Foto</p>
                            <p class="text-xs text-gray-500 mt-2">Maksimal 2MB (JPG/PNG)</p>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-7 flex flex-col gap-6">
                    <div>
                        <label class="text-xs font-bold text-emerald-400 uppercase tracking-wider ml-1 mb-2 block">Judul Berita</label>
                        <input type="text" name="judul" required 
                            class="w-full bg-white/20 border-2 border-dashed border-emerald-900/50 rounded-2xl px-6 py-4 text-gray-700 text-lg font-bold focus:border-emerald-500 focus:bg-white/50 outline-none transition placeholder-gray-600"
                            placeholder="Tulis judul yang menarik...">
                    </div>

                    <div class="flex-grow">
                        <label class="text-xs font-bold text-emerald-400 uppercase tracking-wider ml-1 mb-2 block">Isi Artikel</label>
                        <textarea name="isi" required 
                            class="w-full h-full min-h-[200px] bg-white/20 border-2 border-dashed border-emerald-900/50 rounded-2xl px-6 py-4 text-gray-700 focus:border-emerald-500 focus:bg-white/50 outline-none transition placeholder-gray-600 leading-relaxed resize-none text-[15px]"
                            placeholder="Ceritakan detail kegiatan atau informasi di sini..."></textarea>
                    </div>

                    <div class="flex justify-end pt-2">
                        <button type="submit" name="tambah_berita" class="px-10 py-4 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 text-white rounded-2xl font-bold shadow-lg shadow-emerald-900/40 transition hover:-translate-y-1 w-full md:w-auto flex items-center justify-center gap-2">
                            <span>Publikasikan</span> <i class="fa-solid fa-paper-plane text-sm"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
        {% for b in berita %}
        <article class="group relative flex flex-col bg-white rounded-[2.5rem] overflow-hidden border border-emerald-900/5 shadow-sm hover:shadow-[0_20px_50px_rgba(0,44,34,0.1)] hover:-translate-y-2 transition-all duration-500 h-full">
            
            {% if user.is_authenticated and user.profilpengguna.peran == 'admin_sajiwa' %}
            <form method="POST" onsubmit="return confirm('Hapus berita ini?');" class="absolute top-4 right-4 z-20">
                {% csrf_token %}
                <input type="hidden" name="hapus_id" value="{{ b.id }}">
                <button type="submit" class="w-10 h-10 rounded-full bg-white/90 backdrop-blur-md text-red-500 shadow-lg flex items-center justify-center hover:bg-red-500 hover:text-white transition-all">
                    <i class="fa-solid fa-trash-can text-sm"></i>
                </button>
            </form>
            {% endif %}

            <div class="relative h-64 overflow-hidden">
                {% if b.gambar %}
                    <img src="{{ b.gambar.url }}" alt="{{ b.judul }}" class="w-full h-full object-cover group-hover:scale-110 transition duration-1000">
                {% else %}
                    <div class="w-full h-full bg-emerald-900 flex items-center justify-center">
                        <i class="fa-solid fa-leaf text-white/20 text-5xl"></i>
                    </div>
                {% endif %}
                <div class="absolute bottom-4 left-4 px-4 py-1.5 rounded-full bg-white/90 backdrop-blur-md shadow-lg">
                    <p class="text-[10px] font-black text-emerald-900 uppercase tracking-widest">
                        <i class="fa-regular fa-calendar-check mr-1.5 text-emerald-500"></i>
                        {{ b.tanggal_upload|date:"d M Y" }}
                    </p>
                </div>
            </div>

            <div class="p-8 flex flex-col flex-grow">
                <div class="flex items-center gap-2 mb-4">
                    <span class="px-2 py-0.5 rounded bg-emerald-100 text-[9px] font-black text-emerald-700 uppercase tracking-widest">Update</span>
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-300"></span>
                    <span class="text-[9px] font-bold text-gray-400 uppercase tracking-widest">Oleh Admin</span>
                </div>

                <h2 class="text-xl font-black text-emerald-950 mb-4 leading-tight group-hover:text-emerald-600 transition duration-300 line-clamp-2">
                    {{ b.judul }}
                </h2>

                <div class="text-emerald-900/60 text-sm leading-relaxed line-clamp-4 mb-8 font-medium italic">
                    {{ b.isi }}
                </div>

                <div class="mt-auto pt-6 border-t border-emerald-50 flex items-center justify-between">
                    <span class="text-[11px] font-bold text-emerald-900/30 tracking-tighter uppercase">Sajiwa Ecosystem</span>
                    <button class="flex items-center gap-2 text-emerald-600 font-bold text-xs group-hover:gap-4 transition-all">
                        BACA FULL <i class="fa-solid fa-arrow-right-long"></i>
                    </button>
                </div>
            </div>
        </article>
        {% empty %}
        <div class="col-span-full py-32 text-center bg-white rounded-[3rem] border-2 border-dashed border-emerald-100">
            <div class="w-24 h-24 rounded-full bg-emerald-50 mx-auto flex items-center justify-center mb-6">
                <i class="fa-regular fa-folder-open text-4xl text-emerald-200"></i>
            </div>
            <h3 class="text-xl font-bold text-emerald-950">Belum ada berita</h3>
            <p class="text-emerald-900/40 text-sm mt-2">Nantikan informasi terbaru dari kami segera!</p>
        </div>
        {% endfor %}
    </div>
</div>

{% endblock %}